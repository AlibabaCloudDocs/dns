智能解析 
=========================

传统DNS解析，不判断访问者来源，会随机选择其中一个IP地址返回给访问者。而智能DNS解析，会判断访问者的来源，为不同的访问者智能返回不同的IP地址，可使访问者在访问网站时可获取用户指定的IP地址，能够减少解析时延，并提升网站访问速度的功效。

概述 {#h2-u6982u8FF01}
--------------------

传统DNS解析，不判断访问者来源，会随机选择其中一个IP地址返回给访问者。而智能DNS解析，会判断访问者的来源，为不同的访问者智能返回不同的IP地址，可使访问者在访问网站时可获取用户指定的IP地址，能够减少解析时延，并提升网站访问速度的功效。

### 1 . 传统DNS解析示例 {#h3-1-dns-}

例如域名www.dns-example.com，有三台服务器，分别是联通IP，移动IP，电信IP，DNS解析配置如下：

* 将域名 指向 联通IP地址 （1.1.1.1）

  

* 将域名 指向 移动IP地址 （2.2.2.2）

  

* 将域名 指向 电信IP地址 （3.3.3.3）

  




**可实现的解析效果** ：

传统DNS解析不判断访问者的来源，会将1.1.1.1、2.2.2.2、3.3.3.3三个地址全部返回给访问者的LocalDNS，由访问者的LocalDNS通过随机或者优选的方式将其中一个IP地址返回给访问者，传统DNS解析有可能会造成访问者跨网访问。

### 2 . 智能DNS解析示例 {#h3-2-dns-}

例如域名www.dns-example.com，有三台服务器，分别是联通IP，移动IP，电信IP，DNS解析配置如下：

* 解析线路配置 **默认线路** 指向 联通IP地址 （1.1.1.1）

  

* 解析线路配置 **移动线路** 指向 移动IP地址 （2.2.2.2）

  

* 解析线路配置 **电信线路** 指向 电信IP地址 （3.3.3.3）

  




**可实现的解析效果** 

云解析会判断访问者的来源，为来源于移动运营商的访问者云解析返回2.2.2.2的解析地址，为来源于电信运营商的访问者云解析返回3.3.3.3的解析地址，其他来源的访问者云解析返回1.1.1.1的解析地址

实现原理 {#h2-u5B9Eu73B0u539Fu74062}
--------------------------------

云解析是通过识别LOCALDNS的出口IP，来判断访问者来源。

### 如客户端LOCALDNS支持EDNS {#h3--localdns-edns}

因为云解析DNS支持 [edns-client-subnet](https://help.aliyun.com/document_detail/102237.html#h2-dns-5 "edns-client-subnet") ，所以在获取访问者来源IP时，优先获取 edns-client-subnet 扩展里携带的IP ，如果edns-client-subnet 扩展里存在IP，云解析DNS会以该IP来判断访问者的地理位置 ；如果不存在，则以LocalDNS出口ip来判断访问者的地理位置。

### 如客户端LocalDNS不支持EDNS {#h3--localdns-edns}

LocalDNS会迭代请求至云解析DNS，云解析DNS根据访问者LocalDNS出口IP来判断访问者的地址位置，实现智能解析。

### 如客户端LocalDNS变相支持EDNS {#h3--localdns-edns}

用户发起DNS请求，递归到LocalDNS，则LocalDNS将本次请求发送到二级节点，通过二级节点向云解析DNS发起请求，此时 **云解析DNS会根据LocalDNS二级节点的地域位置返回具体的细分线路解析结果** 。

![来源IP识别原理](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9416420061/p166996.png)



设置方法 {#h2-u8BBEu7F6Eu65B9u6CD53}
--------------------------------

场景一：运营商线路智能解析

1 . 登录[云解析DNS控制台](https://dns.console.aliyun.com "云解析DNS控制台")

2 . 在域名解析页面，全部域名页签下，单击 **域名** ，进入 解析设置页面。

![解析目录](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9416420061/p166997.png)

3 . 在解析设置页面，单击 **添加记录** 按钮

![添加记录按钮](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9416420061/p166998.png)

**示例** ：

如果您拥有3台服务器，分别位于 电信、联通、移动， **添加记录** 时，在 **解析线路** 选择时，按如下配置：

* 默认线路：电信IP（10.10.10.10）

  

* 联通线路：联通IP（1.1.1.1）

  

* 移动线路：移动IP（2.2.2.2）

  




![默认线路](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9416420061/p166999.png)![联通线路](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9416420061/p167000.png)![移动线路](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9416420061/p167001.png)

**实现效果则是** ：

云解析会智能判断出访问者的来源，并返回配置的记录；

* 例如访问者来源于联通运营商，云解析则智能返回联通的IP地址1.1.1.1。

  

* 访问者如果来源于移动运营商，云解析则返回移动IP2.2.2.2。

  

* 访问者来源不属于联通和移动的运营商，则云解析返回默认线路配置的电信IP地址（10.10.10.10）。

  




**以上解析线路的配置结果** ，可实现 **根据不同的访问者来源智能返回指定的IP地址** 。



场景二：阿里云线路智能解析

1 . 参考上述步骤，登录[云解析DNS控制台](https://dns.console.aliyun.com)，并进入解析设置页面

2 . 在解析设置页面，单击 **添加记录** 按钮

![添加记录按钮](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9416420061/p166998.png)

**示例** ：

如果您拥有3台阿里云服务器，分别位于 华东1-杭州、华东2-上海、华北2-北京， **添加记录** 时，在 **解析线路** 选择时，按如下配置：

* 默认线路：华东1-杭州（1.1.1.1）

  

* 阿里云华东2-上海线路：华东2-上海（2.2.2.2）

  

* 阿里云华北2-北京线路：华北2-北京（3.3.3.3）

  




![1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5044232061/p172072.png)![2](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5044232061/p172073.png)![3](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5044232061/p172075.png)

**实现效果则是** ：

云解析会智能判断出访问者的来源，并返回配置的记录；

* 例如访问者来源于阿里云华东2-上海地区，云解析则智能返回华东2-上海的IP地址2.2.2.2。

  

* 访问者如果来源于阿里云华北2-北京地区，云解析则智能返回华北2-北京的IP地址3.3.3.3。

  

* 访问者来源不属于阿里云华东2-上海地区和阿里云华北2-北京地区，则云解析返回默认线路配置的华东1-杭州IP地址（1.1.1.1）。

  






**支持线路** {#h2--strong-strong-4}
-------------------------------

云解析DNS当前能够识别出用户来源的解析线路如下：


|                                                                                                               解析线路                                                                                                               |    子级线路    |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|              阿里云 | 华北1 (青岛)   |
|              阿里云 | 华北2 (北京)   |
|              阿里云 | 华北3 (张家口)  |
|              阿里云 | 华北5 (呼和浩特) |
|              阿里云 | 华东1 (杭州)   |
|              阿里云 | 华东2 (上海)   |
|              阿里云 | 华北6（乌兰察布）  |
|              阿里云 | 华南1 (深圳)   |
|              阿里云 | 华南2 (河源)   |
|              阿里云 | 华南3 (广州)   |
|              阿里云 | 西南1（成都）    |
|              阿里云 | 中国（香港）     |
|              阿里云 | 新加坡        |
|              阿里云 | 澳大利亚（悉尼）   |
|              阿里云 | 马来西亚（吉隆坡）  |
|              阿里云 | 印度尼西亚（雅加达） |
|              阿里云 | 日本（东京）     |
|              阿里云 | 德国（法兰克福）   |
|              阿里云 | 英国（伦敦）     |
|              阿里云 | 美国（硅谷）     |
|              阿里云 | 美国（弗吉尼亚）   |
|              阿里云 | 印度（孟买）     |
|              阿里云 | 中东东部1（迪拜）  |



|         线路名称         |                                              线路省份                                              |
|----------------------|------------------------------------------------------------------------------------------------|
| 默认                   | 全局                                                                                             |
| 中国联通/中国电信/中国移动/中国教育网 | 山东、江苏、安徽、浙江、福建、上海广东、广西、海南湖北、湖南、河南、江西北京、天津、河北、山西、内蒙古宁夏、新疆、青海、陕西、甘肃四川、云南、贵州、西藏、重庆辽宁、吉林、黑龙江       |
| 中国鹏博士                | 安徽、北京、重庆、福建、甘肃广东、广西、贵州、海南、河北、黑龙江、河南、湖北、湖南、江苏、江西、吉林、辽宁、内蒙古、宁夏、青海、陕西、山东、上海、山西、四川、天津、新疆、西藏、云南、浙江  |
| 中国广电网                | 黑龙江、山东、内蒙古、宁夏、湖南、贵州、青海、辽宁、河南、吉林、甘肃、河北、江苏、安徽、福建、海南、湖北、陕西、上海、陕西、四川、天津、西藏、新疆、浙江、北京、重庆、广东、广西、江西、云南 |



| 线路名称 | 大洲  |                                                             国家（地区）                                                             |
|------|-----|--------------------------------------------------------------------------------------------------------------------------------|
| 境外   | -   | -                                                                                                                              |
| 境外   | 大洋洲 | 澳大利亚，新西兰，斐济，帕劳                                                                                                                 |
| 境外   | 亚洲  | 阿联酋，香港，印度尼西亚，印度，日本，柬埔寨，韩国，老挝，缅甸，澳门，马尔代夫，马来西亚，尼泊尔，菲律宾，沙特阿拉伯，新加坡，泰国，台湾，越南，蒙古，巴基斯坦，朝鲜，哈萨克斯坦，乌兹别克斯坦，土耳其，伊朗，伊拉克，以色列，科威特，黎巴嫩，卡塔尔，叙利亚 |
| 境外   | 欧洲  | 奥地利，瑞士，德国，西班牙，法国，英国，意大利，荷兰，俄罗斯，瑞典，捷克，比利时，爱尔兰，丹麦，芬兰，冰岛，匈牙利，波兰，斯洛伐克，白俄罗斯，立陶宛，乌克兰，保加利亚，克罗地亚，葡萄牙，罗马尼亚，斯洛文尼亚                        |
| 境外   | 北美洲 | 加拿大，墨西哥，美国，古巴                                                                                                                  |
| 境外   | 南美洲 | 阿根廷，巴西，哥伦比亚、委内瑞拉、厄瓜多尔、秘鲁、玻利维亚、智利、巴拉圭、乌拉圭                                                                                       |
| 境外   | 非洲  | 南非，埃及，尼日利亚，安哥拉，加纳，科特迪瓦，肯尼亚，塞舌尔，阿尔及利亚，喀麦隆，摩洛哥，塞内加尔，苏丹，南苏丹                                                                       |



| 线路名称 | 地区 |          省份          |
|------|----|----------------------|
| 默认   | -  | -                    |
| 中国地区 | 华东 | 山东、江苏、安徽、江西、浙江、福建、上海 |
| 中国地区 | 华南 | 广东、广西、海南             |
| 中国地区 | 华中 | 湖北、湖南、河南             |
| 中国地区 | 华北 | 北京、天津、河北、山西、内蒙古      |
| 中国地区 | 西北 | 宁夏、新疆、青海、陕西、甘肃       |
| 中国地区 | 西南 | 四川、云南、贵州、西藏、重庆       |
| 中国地区 | 东北 | 辽宁、吉林、黑龙江            |



版本对比 {#h2-u7248u672Cu5BF9u6BD45}
--------------------------------

云解析DNS不同版本提供的解析线路不同，参考如下：


| 功能/版本 |       免费版       |           个人版           |                    企业标准版                    |          企业旗舰版           |
|-------|-----------------|-------------------------|---------------------------------------------|--------------------------|
| 智能解析  | 联通/电信/移动/教育网/境外 | 联通/电信/移动/鹏博士/教育网/广电网，境外 | 阿里云线路，分省（联通/电信/移动/鹏博士/教育网/广电网），境外/大洲/国家（地区） | 包含所有固定智能解析线路，支持自定义IP范围解析 |



常见问题 
-------------------------

您可以参阅 [DNS解析设置FAQ](https://help.aliyun.com/knowledge_detail/39783.html#h2--dns-35 "DNS解析设置FAQ") 文档。

