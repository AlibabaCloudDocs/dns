URL转发类问题排查 
===============================

URL转发包含URL隐性转发和URL显性转发，主要是指将一个域名指向另外一个已经存在的站点时，可以通过URL转发实现。隐性URL转发是用的是iframe框架技术，显性URL转发采用的是302重定向技术（也称之为暂时性转移）。

概念 {#h2-u6982u5FF51}
--------------------

URL转发包含URL隐性转发和URL显性转发，主要是指将一个域名指向另外一个已经存在的站点时，可以通过URL转发实现。隐性URL转发是用的是iframe框架技术，显性URL转发采用的是302重定向技术（也称之为暂时性转移）。

使用规则 {#h2-u4F7Fu7528u89C4u52192}
--------------------------------

添加 URL 转发记录时， **转发前的域名需完成备案且备案接入商为阿里云** 。

* URL转发时记录值不能为IP地址

  

* URL转发不支持泛解析设置。

  

* URL转发的目标域名不支持中文域名。

  

* URL转发前域名支持HTTP，不支持HTTPS，转发后的目标地址支持HTTP、HTTPS。

  

* URL转发属于特殊商品，云解析不提供攻击防护服务，如遇攻击黑洞时无法使用URL转发，请将需要转发的主机记录配置为A或CNAME记录。

  




原理说明 {#h2-u539Fu7406u8BF4u660E3}
--------------------------------

用户添加URL转发记录时，云解析DNS会自动为用户添加A记录，而A记录指向的地址则是云解析DNS提供的URL转发服务器地址，目的就是通过URL转发服务器来帮助用户实现转发功能。当访问者访问转发前域名时，实际上是向云解析DNS提供的URL转发服务器发起请求，如果是隐性url转发，则是通过云解析DNS的应用来嵌套用户目标的url，并返回带有iframe的页面给到访问者；如果是显性URL转发，则是通过302重定向跳转到转发后页面。

常见问题 {#h2-u5E38u89C1u95EEu98984}
--------------------------------

**1 . 添加URL转发记录后，dig 域名 返回的解析结果与控制台设置不一致。** 

用户添加URL转发记录时，云解析DNS会自动为用户添加A记录，而A记录指向的地址则是云解析DNS提供的URL转发服务器地址，所以如果控制台添加的记录值是URL，而dig出来的是A记录且IP地址是（203.107.43.165/203.107.42.43），这是属于正常现象。

**2 . 添加URL转发记录后，使用域名访问页面显示 HTTP ERROR 502 错误。** 

* 如果在添加URL转发记录时，提示未备案，不允许添加的情况：请同时检查转发前的域名和转发后的域名是否完成备案，如果未完成则请联系您服务器厂商完成备案。

  

* 如果已添加过URL转发记录，出现502错误，则可能为备案失效导致，请联系您的备案接入商进行排查。

  




**3 . 添加隐性URL转发记录后，使用域名访问页面显示为空白页。** 

从浏览器（例如chrome）可以查看到如下报错提示，这是由于转发后站点header中设置了X-Frame-Options，主要是转发后站点不允许做嵌套，所以需要联系您的网站技术人员，在转发后站点中去掉X-Frame-Options的配置即可。![URL转发空白](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0497582161/p240979.png)

**4 .添加隐性URL转发记录后，页面可以正常打开，但是url上显示了转发目标地址。** 

请检查转发后的URL页面中的JS代码，如果有下图标记的设置，请去掉此段js代码。![URL转发JS代码](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0497582161/p240980.png)



**5 .添加URL转发记录后，操作页面刷新，直接跳转到了非目标地址的页面。** 

一般出现这种情况，多为目标页面（转发后的ULR站点）中可能有JS代码设置了跳转，需要您联系您的网站技术人员进行排查。

**6 .在云解析DNS中添加了URL转发记录，但是dig测试没有返回对应的A记录和记录值（203.107.43.165/203.107.42.43）** 请提交 [云解析DNS工单](https://selfservice.console.aliyun.com/ticket/category/alidns/today "云解析DNS工单")，由技术人员为您处理。

**7 .添加URL转发记录后，打开页面提示 ERR_EMPTY_RESPONSE 错误** 

一般出现于CC攻击场景，因为域名请求的QPS过大，所以URL转发服务器停止了该域名的转发服务，建议您使用其他方式实现转发服务。

**8 .添加URL转发记录后，打开页面提示example.com已拒绝连接** 

**现象：在console中不显示拦截的相关信息。** 

**原因：是由于same-origin拦截。需要从网络中看连路上最后一次200请求返回的Header头部，里面可能会有same-origin的限制返回。** 

**解决：此类问题一般为用户网站安全策略设置问题，建议用户检查配置，或者直使用显性URL转发配置。** 

![1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8439083161/p241492.png)![2](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8439083161/p241493.png)



